(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();let c="idle",d="pomodoro",r=1500,i=null,g=0;const f={workDuration:25,shortBreakDuration:5,longBreakDuration:15,longBreakInterval:4};function w(){c!=="running"&&(c="running",p(),i=window.setInterval(()=>{r>0?(r--,B()):T()},1e3),naimo.log.info("è®¡æ—¶å™¨å·²å¯åŠ¨",{mode:d,duration:r}))}function h(){c==="running"&&(c="paused",i!==null&&(clearInterval(i),i=null),p(),naimo.log.info("è®¡æ—¶å™¨å·²æš‚åœ"))}function L(){c="idle",i!==null&&(clearInterval(i),i=null),l(d),p(),naimo.log.info("è®¡æ—¶å™¨å·²é‡ç½®")}async function T(){i!==null&&(clearInterval(i),i=null),c="idle",window.pomodoroAPI.playNotificationSound(),d==="pomodoro"?(g++,await A(),await naimo.system.notify("ğŸ‰ ç•ªèŒ„é’Ÿå®Œæˆï¼ä¼‘æ¯ä¸€ä¸‹å§","ç•ªèŒ„é’Ÿè®¡æ—¶å™¨"),g%f.longBreakInterval===0?l("longBreak"):l("shortBreak")):(await naimo.system.notify("â° ä¼‘æ¯æ—¶é—´ç»“æŸï¼ç»§ç»­åŠ æ²¹","ç•ªèŒ„é’Ÿè®¡æ—¶å™¨"),l("pomodoro")),p(),E()}function l(t){switch(d=t,t){case"pomodoro":r=f.workDuration*60;break;case"shortBreak":r=f.shortBreakDuration*60;break;case"longBreak":r=f.longBreakDuration*60;break}B(),y()}function B(){const t=document.getElementById("timeDisplay");t&&(t.textContent=window.pomodoroAPI.formatTime(r));const e={pomodoro:"ğŸ… ä¸“æ³¨å·¥ä½œ",shortBreak:"â˜• çŸ­ä¼‘æ¯",longBreak:"ğŸŒŸ é•¿ä¼‘æ¯",custom:"â±ï¸ è‡ªå®šä¹‰"},o=document.getElementById("modeTitle");o&&(o.textContent=e[d])}function p(){const t=document.getElementById("startBtn"),e=document.getElementById("pauseBtn"),o=document.getElementById("resetBtn");t&&e&&o&&(c==="running"?(t.disabled=!0,e.disabled=!1,o.disabled=!1):(t.disabled=!1,e.disabled=!0,o.disabled=!1))}function y(){["pomodoro","shortBreak","longBreak"].forEach(e=>{const o=document.getElementById(`${e}Btn`);o&&(e===d?o.classList.add("active"):o.classList.remove("active"))})}function m(t){document.querySelectorAll(".tab-btn").forEach(s=>{s.getAttribute("data-tab")===t?s.classList.add("active"):s.classList.remove("active")}),document.querySelectorAll(".tab-panel").forEach(s=>{s.getAttribute("data-panel")===t?s.classList.add("active"):s.classList.remove("active")})}async function A(){try{const t=window.pomodoroAPI.getTodayString(),e=await naimo.storage.getItem("pomodoro_stats")||{};e[t]||(e[t]={count:0,workTime:0}),e[t].count++,e[t].workTime+=f.workDuration,await naimo.storage.setItem("pomodoro_stats",e)}catch(t){console.error("ä¿å­˜ç»Ÿè®¡æ•°æ®å¤±è´¥:",t)}}async function E(){try{const t=window.pomodoroAPI.getTodayString(),o=(await naimo.storage.getItem("pomodoro_stats")||{})[t]||{count:0,workTime:0},s=document.getElementById("statistics");s&&(s.innerHTML=`
        <div class="stat-card">
          <span class="stat-icon">âœ…</span>
          <span class="stat-label">ä»Šæ—¥å®Œæˆ</span>
          <span class="stat-value">${o.count} ä¸ª</span>
        </div>
        <div class="stat-card">
          <span class="stat-icon">â°</span>
          <span class="stat-label">ä»Šæ—¥å·¥ä½œ</span>
          <span class="stat-value">${o.workTime} åˆ†é’Ÿ</span>
        </div>
        <div class="stat-card">
          <span class="stat-icon">ğŸ”¥</span>
          <span class="stat-label">æœ¬æ¬¡ä¼šè¯</span>
          <span class="stat-value">${g} ä¸ª</span>
        </div>
      `)}catch(t){console.error("æ›´æ–°ç»Ÿè®¡æ˜¾ç¤ºå¤±è´¥:",t)}}function S(){const t=document.getElementById("customMinutes");if(!t)return;const e=parseInt(t.value);if(isNaN(e)||e<=0||e>120){naimo.system.notify("è¯·è¾“å…¥1-120ä¹‹é—´çš„æ•°å­—","ç•ªèŒ„é’Ÿè®¡æ—¶å™¨");return}d="custom",r=e*60,B(),y(),naimo.log.info("è®¾ç½®è‡ªå®šä¹‰æ—¶é—´",{minutes:e})}async function I(){console.log("ç•ªèŒ„é’Ÿåº”ç”¨åˆå§‹åŒ–..."),document.querySelectorAll(".tab-btn").forEach(b=>{b.addEventListener("click",()=>{const k=b.getAttribute("data-tab");k&&m(k)})});const e=document.getElementById("startBtn"),o=document.getElementById("pauseBtn"),s=document.getElementById("resetBtn");e&&e.addEventListener("click",w),o&&o.addEventListener("click",h),s&&s.addEventListener("click",L);const n=document.getElementById("pomodoroBtn"),a=document.getElementById("shortBreakBtn"),u=document.getElementById("longBreakBtn"),v=document.getElementById("customBtn");n&&n.addEventListener("click",()=>{l("pomodoro"),m("timer")}),a&&a.addEventListener("click",()=>{l("shortBreak"),m("timer")}),u&&u.addEventListener("click",()=>{l("longBreak"),m("timer")}),v&&v.addEventListener("click",()=>{S(),m("timer")}),B(),p(),y(),await E(),naimo.log.info("ç•ªèŒ„é’Ÿåº”ç”¨åˆå§‹åŒ–å®Œæˆ")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I();
