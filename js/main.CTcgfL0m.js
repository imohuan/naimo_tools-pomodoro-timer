(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();let c="idle",d="pomodoro",r=1500,i=null,g=0;const f={workDuration:25,shortBreakDuration:5,longBreakDuration:15,longBreakInterval:4};function w(){c!=="running"&&(c="running",p(),i=window.setInterval(()=>{r>0?(r--,B()):T()},1e3),naimo.log.info("计时器已启动",{mode:d,duration:r}))}function h(){c==="running"&&(c="paused",i!==null&&(clearInterval(i),i=null),p(),naimo.log.info("计时器已暂停"))}function L(){c="idle",i!==null&&(clearInterval(i),i=null),l(d),p(),naimo.log.info("计时器已重置")}async function T(){i!==null&&(clearInterval(i),i=null),c="idle",window.pomodoroAPI.playNotificationSound(),d==="pomodoro"?(g++,await A(),await naimo.system.notify("🎉 番茄钟完成！休息一下吧","番茄钟计时器"),g%f.longBreakInterval===0?l("longBreak"):l("shortBreak")):(await naimo.system.notify("⏰ 休息时间结束！继续加油","番茄钟计时器"),l("pomodoro")),p(),E()}function l(t){switch(d=t,t){case"pomodoro":r=f.workDuration*60;break;case"shortBreak":r=f.shortBreakDuration*60;break;case"longBreak":r=f.longBreakDuration*60;break}B(),y()}function B(){const t=document.getElementById("timeDisplay");t&&(t.textContent=window.pomodoroAPI.formatTime(r));const e={pomodoro:"🍅 专注工作",shortBreak:"☕ 短休息",longBreak:"🌟 长休息",custom:"⏱️ 自定义"},o=document.getElementById("modeTitle");o&&(o.textContent=e[d])}function p(){const t=document.getElementById("startBtn"),e=document.getElementById("pauseBtn"),o=document.getElementById("resetBtn");t&&e&&o&&(c==="running"?(t.disabled=!0,e.disabled=!1,o.disabled=!1):(t.disabled=!1,e.disabled=!0,o.disabled=!1))}function y(){["pomodoro","shortBreak","longBreak"].forEach(e=>{const o=document.getElementById(`${e}Btn`);o&&(e===d?o.classList.add("active"):o.classList.remove("active"))})}function m(t){document.querySelectorAll(".tab-btn").forEach(s=>{s.getAttribute("data-tab")===t?s.classList.add("active"):s.classList.remove("active")}),document.querySelectorAll(".tab-panel").forEach(s=>{s.getAttribute("data-panel")===t?s.classList.add("active"):s.classList.remove("active")})}async function A(){try{const t=window.pomodoroAPI.getTodayString(),e=await naimo.storage.getItem("pomodoro_stats")||{};e[t]||(e[t]={count:0,workTime:0}),e[t].count++,e[t].workTime+=f.workDuration,await naimo.storage.setItem("pomodoro_stats",e)}catch(t){console.error("保存统计数据失败:",t)}}async function E(){try{const t=window.pomodoroAPI.getTodayString(),o=(await naimo.storage.getItem("pomodoro_stats")||{})[t]||{count:0,workTime:0},s=document.getElementById("statistics");s&&(s.innerHTML=`
        <div class="stat-card">
          <span class="stat-icon">✅</span>
          <span class="stat-label">今日完成</span>
          <span class="stat-value">${o.count} 个</span>
        </div>
        <div class="stat-card">
          <span class="stat-icon">⏰</span>
          <span class="stat-label">今日工作</span>
          <span class="stat-value">${o.workTime} 分钟</span>
        </div>
        <div class="stat-card">
          <span class="stat-icon">🔥</span>
          <span class="stat-label">本次会话</span>
          <span class="stat-value">${g} 个</span>
        </div>
      `)}catch(t){console.error("更新统计显示失败:",t)}}function S(){const t=document.getElementById("customMinutes");if(!t)return;const e=parseInt(t.value);if(isNaN(e)||e<=0||e>120){naimo.system.notify("请输入1-120之间的数字","番茄钟计时器");return}d="custom",r=e*60,B(),y(),naimo.log.info("设置自定义时间",{minutes:e})}async function I(){console.log("番茄钟应用初始化..."),document.querySelectorAll(".tab-btn").forEach(b=>{b.addEventListener("click",()=>{const k=b.getAttribute("data-tab");k&&m(k)})});const e=document.getElementById("startBtn"),o=document.getElementById("pauseBtn"),s=document.getElementById("resetBtn");e&&e.addEventListener("click",w),o&&o.addEventListener("click",h),s&&s.addEventListener("click",L);const n=document.getElementById("pomodoroBtn"),a=document.getElementById("shortBreakBtn"),u=document.getElementById("longBreakBtn"),v=document.getElementById("customBtn");n&&n.addEventListener("click",()=>{l("pomodoro"),m("timer")}),a&&a.addEventListener("click",()=>{l("shortBreak"),m("timer")}),u&&u.addEventListener("click",()=>{l("longBreak"),m("timer")}),v&&v.addEventListener("click",()=>{S(),m("timer")}),B(),p(),y(),await E(),naimo.log.info("番茄钟应用初始化完成")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",I):I();
